Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:07<00:07,  7.24s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:09<00:00,  4.15s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:09<00:00,  4.61s/it]
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:09<00:09,  9.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:12<00:00,  5.91s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:12<00:00,  6.45s/it]
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:05<00:05,  5.65s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.50s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:07<00:00,  3.82s/it]
/home/ctisseau/miniconda3/envs/clm_finetune/lib/python3.11/site-packages/outlines/fsm/guide.py:110: UserWarning: Outlines' public *community-contributed* CFG structured generation is experimental. Please review https://dottxt-ai.github.io/outlines/latest/reference/generation/cfg#disclaimer
  warnings.warn(
Epoch 1/3:   0%|          | 0/1 [00:00<?, ?it/s]Epoch 1/3:   0%|          | 0/1 [01:29<?, ?it/s]
Traceback (most recent call last):
  File "/home/ctisseau/llm_lcd_finetune/test_cfg.py", line 174, in <module>
    finetune_test(
  File "/home/ctisseau/llm_lcd_finetune/test_cfg.py", line 133, in finetune_test
    biased_logits[i, j, :] = cfg.process_logits(batch_input_ids[i, :j].unsqueeze(0), logits[i, j, :].unsqueeze(0))  # returns shape (batch, seq_len, vocab)
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ctisseau/llm_lcd_finetune/ConstraintLM/constraintlm/processors/structured.py", line 56, in process_logits
    curr_state = self.guide.get_next_state(prev_state, gen_ids[-1].item())
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ctisseau/miniconda3/envs/clm_finetune/lib/python3.11/site-packages/outlines/fsm/guide.py", line 218, in get_next_state
    parser_state = self._get_parser_state_token_applied(state, int(token_id))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ctisseau/miniconda3/envs/clm_finetune/lib/python3.11/site-packages/outlines/fsm/guide.py", line 250, in _get_parser_state_token_applied
    self.parser.parse_from_state(parser_state, is_end=False)
  File "/home/ctisseau/miniconda3/envs/clm_finetune/lib/python3.11/site-packages/outlines/fsm/parsing.py", line 150, in parse_from_state
    return self.parser.parser.parser.parse_from_state(parse_state, is_end=is_end)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ctisseau/miniconda3/envs/clm_finetune/lib/python3.11/site-packages/outlines/fsm/parsing.py", line 546, in parse_from_state
    raise e
  File "/home/ctisseau/miniconda3/envs/clm_finetune/lib/python3.11/site-packages/outlines/fsm/parsing.py", line 534, in parse_from_state
    for token in state.lexer.lex(state):
  File "/home/ctisseau/miniconda3/envs/clm_finetune/lib/python3.11/site-packages/outlines/fsm/parsing.py", line 678, in lex
    next_tok = lexer.next_token(lexer_state, parser_state)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ctisseau/miniconda3/envs/clm_finetune/lib/python3.11/site-packages/outlines/fsm/parsing.py", line 763, in next_token
    raise UnexpectedCharacters(
lark.exceptions.UnexpectedCharacters: No terminal matches 'x' in the current parser context, at line 3 col 5

    x
    ^
Expected one of: 
	* <END-OF-FILE>

Previous tokens: Token('_NEWLINE', '\n    ')

